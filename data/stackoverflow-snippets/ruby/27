def hsort(array)
  array.group_by(&:last).flat_map { |_, v| v.sort_by(&:first).reverse }
end

p hsort([["a", 1], ["b", 1], ["d", 1], ["k", 1], ["r", 1], ["f", 2], ["j", 2], ["o", 2], ["i", 3], ["s", 3]])
# [["r", 1], ["k", 1], ["d", 1], ["b", 1], ["a", 1], ["o", 2], ["j", 2], ["f", 2], ["s", 3], ["i", 3]]
p hsort([["e", 1], ["b", 1], ["d", 1], ["k", 1], ["r", 1], ["f", 2], ["j", 2], ["o", 2], ["i", 3], ["s", 3]])
# [["r", 1], ["k", 1], ["e", 1], ["d", 1], ["b", 1], ["o", 2], ["j", 2], ["f", 2], ["s", 3], ["i", 3]]
